<!-- <!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>TerraSure Admin Panel</title>
  <style>
    body { font-family: Arial, sans-serif; margin: 0; }
    nav { background: #007bff; color: white; padding: 12px; text-align: center; }
    nav button { background: white; color: #007bff; border: none; padding: 10px 20px; margin: 0 6px; cursor: pointer; }
    .section { display: none; padding: 20px; }
    .active { display: block; }
    input, select, button, textarea { width: 100%; padding: 8px; margin: 6px 0; }
    table { width: 100%; border-collapse: collapse; margin-top: 12px; }
    th, td { border: 1px solid #ccc; padding: 8px; text-align: left; }
    th { background-color: #f4f4f4; }
    .error { color: red; }
    .success { color: green; }
    .row-guest { background-color: #fff0f0; }
    .row-admin { background-color: #f0f8ff; }
  </style>
</head>
<body> -->

<!-- Login -->
<!-- <div id="loginSection" class="section active">
  <h2>Admin Login</h2>
  <input id="username" placeholder="Username" />
  <input id="password" type="password" placeholder="Password" />
  <button onclick="login()">Login</button>
  <p id="loginMsg" class="error"></p>
  <p>Don’t have an account? <a href="#" onclick="switchView('signup')">Create Admin</a></p>
</div> -->

<!-- Map Locator-->
<!-- <section id="mapSection" style="margin-top: 20px;">
  <h2>Select Property Location (No Login Required)</h2>

  <label for="propertyName">Property Name</label>
  <input type="text" id="propertyName" placeholder="e.g. Plot 3, Sangotedo Estate">

  <label for="address">Address</label>
  <input type="text" id="address" placeholder="Enter address">

  <button onclick="geocodeAddress()">Find on Map</button>

  <div id="map" style="height: 400px; margin: 15px 0;"></div>

  <label>Latitude</label>
  <input type="text" id="lat" readonly>
  <label>Longitude</label>
  <input type="text" id="lng" readonly>

  <button onclick="submitGuestLocation()">Submit Property Location</button>
</section> -->

<!-- Signup -->
<!-- <div id="signup" class="section">
  <h2>Create Account</h2>
  <form id="registerForm">
    <label>Email</label>
    <input type="email" id="regEmail" required>

    <label>Password</label>
    <input type="password" id="regPassword" required>

    <button type="submit">Create Account</button>
  </form>
  <p id="regStatus" style="color: red;"></p>
</div> -->

<!-- Navigation -->
<!-- <nav id="navBar" class="section">
  <button onclick="switchView('registerSection')">Register Property</button>
  <button onclick="switchView('dashboardSection')">Dashboard</button>
  <button onclick="switchView('mapSection')">Map Locator</button>
  <button onclick="logout()">Logout</button>
</nav> -->


<!-- Register Property (Admin Only)-->
<!-- <div id="registerSection" class="section">
  <h2>Register Property</h2>
  <input id="adminPropertyName" placeholder="Property Name" />
  <input id="adminPropertyType" placeholder="Property Type" />
  <input id="adminAddress" placeholder="Address" />
  <input id="adminLatitude" type="number" step="any" placeholder="Latitude" />
  <input id="adminLongitude" type="number" step="any" placeholder="Longitude" />
  <input id="adminDocUpload" type="file" />
  <input id="adminDocumentUrl" placeholder="Document URL (if no file)" />
  <button onclick="submitProperty()">Submit</button>
  <p id="adminFormMsg"></p>
</div> -->

<!-- Dashboard(Admin Only) -->
<!-- <div id="dashboardSection" class="section">
  <h2>All Properties</h2>
  <button onclick="loadProperties()">Refresh</button>
  <div id="dashboardContent"></div>
</div> -->


<!-- <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyBI7tc5tLtVbHe4nWdz62R2RogYe4fI6JU&libraries=places"></script>
<script>
// Replace YOUR_API_URL with actual endpoint base
const API_BASE = "https://dtqw9szt1eom5.cloudfront.net";
let token = "";

  function switchView(view) {
  document.querySelectorAll('.section').forEach(s => s.classList.remove('active'));
  document.getElementById(view).classList.add('active');
  if (view === 'dashboardSection') loadProperties();
}

function login() {
  fetch(`${API_BASE}/api/auth/login`, {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify({
      username: document.getElementById("loginUsername").value,
      password: document.getElementById("loginPassword").value
    })
  }).then(res => res.json())
    .then(data => {
      if (data.token) {
        token = data.token;
        switchView('registerSection');
        document.getElementById("navBar").classList.add("active");
      } else {
        document.getElementById("loginMsg").innerText = "Invalid credentials";
      }
    });
}

document.getElementById('registerForm').addEventListener('submit', async function (e) {
  e.preventDefault();
  const email = document.getElementById('regEmail').value;
  const username = email.split('@')[0];
  const password = document.getElementById('regPassword').value;

  const res = await fetch(`${API_BASE}/api/auth/register`, {
    method: 'POST',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify({ username, email, password })
  });

  const data = await res.json();
  document.getElementById('regStatus').innerText = res.ok ? "✅ Created!" : (data.message || "Error");
});

// Google Maps
let map, marker, geocoder;
function initMap() {
  geocoder = new google.maps.Geocoder();
  const defaultPos = { lat: 6.5244, lng: 3.3792 };
  map = new google.maps.Map(document.getElementById("map"), { zoom: 12, center: defaultPos });
  marker = new google.maps.Marker({ map, position: defaultPos });

  map.addListener("click", e => {
    marker.setPosition(e.latLng);
    updateLatLng(e.latLng);
    reverseGeocode(e.latLng);
  });
}

function updateLatLng(pos) {
  document.getElementById('guestLat').value = pos.lat();
  document.getElementById('guestLng').value = pos.lng();
}

function geocodeAddress() {
  const address = document.getElementById('guestAddress').value;
  geocoder.geocode({ address }, (results, status) => {
    if (status === 'OK') {
      const location = results[0].geometry.location;
      map.setCenter(location);
      marker.setPosition(location);
      updateLatLng(location);
    } else {
      alert('Geocode failed: ' + status);
    }
  });
}

function reverseGeocode(latlng) {
  geocoder.geocode({ location: latlng }, (results, status) => {
    if (status === 'OK' && results[0]) {
      document.getElementById('guestAddress').value = results[0].formatted_address;
    }
  });
}

function submitGuestLocation() {
  const payload = {
    propertyName: document.getElementById('guestPropertyName').value,
    address: document.getElementById('guestAddress').value,
    latitude: parseFloat(document.getElementById('guestLat').value),
    longitude: parseFloat(document.getElementById('guestLng').value)
  };

  fetch(`${API_BASE}/api/properties/guest-location`, {
    method: 'POST',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify(payload)
  })
    .then(res => res.json())
    .then(data => {
      if (data.success) {
        document.getElementById('guestMsg').innerText = "✅ Submitted!";
        document.getElementById('guestPropertyName').value = '';
        document.getElementById('guestAddress').value = '';
        document.getElementById('guestLat').value = '';
        document.getElementById('guestLng').value = '';
      }
    });
}

function submitProperty() {
  const name = document.getElementById("adminPropertyName").value;
  const type = document.getElementById("adminPropertyType").value;
  const address = document.getElementById("adminAddress").value;
  const lat = document.getElementById("adminLatitude").value;
  const lng = document.getElementById("adminLongitude").value;
  const file = document.getElementById("adminDocUpload").files[0];
  const docUrl = document.getElementById("adminDocumentUrl").value;
  const msg = document.getElementById("adminFormMsg");

  const formData = new FormData();
  formData.append("propertyName", name);
  formData.append("propertyType", type);
  formData.append("address", address);
  formData.append("latitude", lat);
  formData.append("longitude", lng);
  if (file) formData.append("document", file);
  else if (docUrl) formData.append("documentUrl", docUrl);

  fetch(`${API_BASE}/api/properties`, {
    method: "POST",
    headers: { Authorization: "Bearer " + token },
    body: formData
  }).then(res => res.json())
    .then(data => {
      msg.innerText = data.id ? "✅ Property saved" : "❌ Failed to save";
    });
}

function loadProperties() {
  fetch(`${API_BASE}/api/properties`, {
    headers: { Authorization: "Bearer " + token }
  }).then(res => res.json())
    .then(({ data }) => renderGroupedDashboard(groupBySubmitter(data)));
}

function groupBySubmitter(properties) {
  const grouped = {};
  properties.forEach(p => {
    const key = p.submittedBy || 'guest';
    if (!grouped[key]) grouped[key] = [];
    grouped[key].push(p);
  });
  return grouped;
}

function renderGroupedDashboard(grouped) {
  const container = document.getElementById('dashboardContent');
  container.innerHTML = '';
  for (const submitter in grouped) {
    const rows = grouped[submitter].map(p => `
      <tr class="${submitter === 'guest' ? 'row-guest' : 'row-admin'}">
        <td>${p.propertyName}</td>
        <td>${p.propertyType || ''}</td>
        <td>${p.address || ''}</td>
        <td>${p.latitude}</td>
        <td>${p.longitude}</td>
        <td>${p.documentUrl ? `<a href="${p.documentUrl}" target="_blank">View</a>` : '-'}</td>
      </tr>`).join('');
    container.innerHTML += `
      <h3>Submitted by: ${submitter}</h3>
      <table>
        <thead><tr><th>Name</th><th>Type</th><th>Address</th><th>Lat</th><th>Lng</th><th>Doc</th></tr></thead>
        <tbody>${rows}</tbody>
      </table>`;
  }
}

function logout() {
  token = "";
  switchView('loginSection');
  document.getElementById("navBar").classList.remove("active");
}

window.onload = initMap;
</script>
</body>
</html> -->
